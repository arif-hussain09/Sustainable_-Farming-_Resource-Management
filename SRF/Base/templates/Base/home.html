{% extends "main.html" %}
{%block content%}

    <!-- Main Container -->
    <div class="container mt-5">
        <!-- Dashboard Section -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Summary</h5>
                        <p class="card-text">Overview of farms, soil health, irrigation schedules, etc.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Crop Yield Chart</h5>
                        <canvas id="cropYieldChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Table Section (e.g. Farmers Management) -->
        <div class="row mt-5">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Farmers</h5>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Farmer Name</th>
                                    <th>Contact</th>
                                    <th>Farm Size</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>John Doe</td>
                                    <td>+123456789</td>
                                    <td>25 Acres</td>
                                    <td><button class="btn btn-primary btn-sm">Edit</button></td>
                                </tr>
                                <tr>
                                    <td>Jane Smith</td>
                                    <td>+987654321</td>
                                    <td>15 Acres</td>
                                    <td><button class="btn btn-primary btn-sm">Edit</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js Script for Crop Yield Chart -->
    <script>
        // Initial data for crops and farms
        const farmData = {
            "Wheat": [120, 150, 180, 200, 220],
            "Corn": [80, 100, 90, 150, 170],
            "Rice": [200, 250, 300, 400, 350],
            "Soybeans": [100, 130, 160, 180, 190],
        };

        // Initial Crop Yield Chart
        const ctx = document.getElementById('cropYieldChart').getContext('2d');
        let cropYieldChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Farm A', 'Farm B', 'Farm C', 'Farm D', 'Farm E'], // Farm names
                datasets: [{
                    label: 'Total Crop Yield (kg)',
                    data: farmData["Wheat"], // Default data (for Wheat)
                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Function to dynamically update chart based on searched crop
        function updateChart() {
            const searchInput = document.getElementById("searchCrop").value;
            const crop = searchInput.trim();

            // Check if the crop exists in farmData
            if (crop in farmData) {
                cropYieldChart.data.datasets[0].data = farmData[crop]; // Update chart data
                cropYieldChart.data.datasets[0].label = `${crop} Yield (kg)`; // Update chart label
                cropYieldChart.update(); // Update the chart
            } else {
                alert("Crop not found. Please try another crop.");
            }
        }
    </script>

    <!-- Bootstrap JS and dependencies (Popper.js and JavaScript) -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

{%endblock%}